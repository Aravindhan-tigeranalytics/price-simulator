<div class="container-fluid">
  <!-- <div class="row pb-1 mb-3 cust" #filterHeader [class.sticky]="sticky_header">
    <div class="col-8">
      <div
        #initElement
        class="d-flex flex-row justify-content-between align-items-center"
      >
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Select Retailer</mat-label>
            <mat-select [formControl]="retailers" multiple>
              <mat-option [value]="'ALL'">All</mat-option>
              <mat-option
                *ngFor="let retailer of retailer_filter"
                [value]="retailer"
                >{{ retailer }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Select Category</mat-label>
            <mat-select [formControl]="categories" multiple>
              <mat-option [value]="'ALL'">All</mat-option>
              <mat-option
                *ngFor="let category of categories_filter"
                [value]="category"
                >{{ category }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Select PPG</mat-label>
            <mat-select [formControl]="products" multiple>
              <mat-option [value]="'ALL'">All</mat-option>
              <mat-option
                *ngFor="let product of product_filter"
                [value]="product"
                >{{ product }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="d-flex flex-row justify-content-start align-items-center">
        <div class="p-2 flex-fill">
          <a class="btn btn-primary btn-block theme-btn" (click)="applyFilter()"
            >Apply</a
          >
        </div>
        <div class="p-2 flex-fill">
          <a class="btn btn-primary btn-block" (click)="resetFilter()">Reset</a>
        </div>
      </div>
    </div>
  </div> -->
  <div class="row mb-1">
    <ng-container *ngIf="inputForm">
      <form [formGroup]="inputForm">
        <div class="col table-responsive d-flex">
          <table class="table table-bordered table-striped table-hover">
            <thead class="no-border-head">
              <tr style="height: 65px;background-color: var(--color-light-grey-1);color: var(--color-blue-1);">
                <th scope="col" style="width: 215px"></th>
                <th scope="col"></th>
                <th scope="col"></th>
                <th scope="col"></th>

                <th scope="col" style="padding: 0; vertical-align: middle;">
                  <div
                    class="d-flex flex-column align-items-center custome-input"
                  >
                    <mde-popover
                      #appPopover="mdePopover"
                      [mdePopoverOverlapTrigger]="false"
                    >
                      <mat-card style="max-width: 300px">
                        <mat-card-content>
                         select LPI % wef date
                        </mat-card-content>
                      </mat-card>
                    </mde-popover>

                    <mat-form-field color="accent" appearance="fill">
                      <mat-label>Choose Date</mat-label>
                      <input
                        matInput
                        [(ngModel)]="date_lpi"
                        [ngModelOptions]="{ standalone: true }"
                        [matDatepicker]="picker1"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker1"
                        [mdePopoverTriggerFor]="appPopover"
                        mdePopoverTriggerOn="hover"
                        #popoverTrigger="mdePopoverTrigger"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker1 color="primary"></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <span *ngIf="date_lpi"
                    >{{ date_lpi | date }}
                    <i
                      class="fa fa-trash"
                      (click)="date_lpi = null"
                      aria-hidden="true"
                    ></i
                  ></span>
                  <!-- <mat-chip
                >11/24/20
              
              </mat-chip> -->
                  <!-- <div class="d-flex flex-column custome-input">
                
                <mat-form-field color="accent" appearance="fill">
                  <mat-label>Choose Date</mat-label>
                  <input
                    matInput
                    [(ngModel)]="date"
                    [matDatepicker]="picker1"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker1"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker1 color="primary"></mat-datepicker>
                </mat-form-field>
              </div> -->
                </th>
                <th
                  scope="col"
                  style="padding: 0; vertical-align: middle"
                  class="table-cal"
                >
                  <mde-popover
                    #appPopover1="mdePopover"
                    [mdePopoverOverlapTrigger]="false"
                  >
                    <mat-card style="max-width: 300px">
                      <mat-card-content>
                        select RSP % wef date
                      </mat-card-content>
                    </mat-card>
                  </mde-popover>
                  <div
                    class="d-flex flex-column custome-input align-items-center"
                  >
                    <mat-form-field color="accent" appearance="fill">
                      <mat-label>Choose Date</mat-label>
                      <input
                        matInput
                        [matDatepicker]="picker2"
                        [(ngModel)]="date_rsp"
                        [ngModelOptions]="{ standalone: true }"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker2"
                        [mdePopoverTriggerFor]="appPopover1"
                        mdePopoverTriggerOn="hover"
                        #popoverTrigger="mdePopoverTrigger"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker2 color="primary"></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <span *ngIf="date_rsp"
                    >{{ date_rsp | date }}
                    <i
                      class="fa fa-trash"
                      (click)="date_rsp = null"
                      aria-hidden="true"
                    ></i
                  ></span>
                  <!-- <div class="d-flex flex-column custome-input">
                <mat-form-field color="accent" appearance="fill">
                  <mat-label>Choose Date</mat-label>
                  <input matInput [matDatepicker]="picker2" />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker2"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker2 color="primary"></mat-datepicker>
                </mat-form-field>
              </div> -->
                </th>
                <th scope="col" style="padding: 0; vertical-align: middle">
                  <mde-popover
                    #appPopover2="mdePopover"
                    [mdePopoverOverlapTrigger]="false"
                  >
                    <mat-card style="max-width: 300px">
                      <mat-card-content>
                        select COGS % wef date
                      </mat-card-content>
                    </mat-card>
                  </mde-popover>
                  <div
                    class="d-flex flex-column justify-content-start align-items-center custome-input"
                  >
                    <mat-form-field color="accent" appearance="fill">
                      <mat-label>Choose Date</mat-label>
                      <input
                        matInput
                        [matDatepicker]="picker3"
                        [(ngModel)]="date_cogs"
                        [ngModelOptions]="{ standalone: true }"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker3"
                        [mdePopoverTriggerFor]="appPopover2"
                        mdePopoverTriggerOn="hover"
                        #popoverTrigger="mdePopoverTrigger"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker3 color="primary"></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <span *ngIf="date_cogs"
                    >{{ date_cogs | date }}
                    <i
                      class="fa fa-trash"
                      (click)="date_cogs = null"
                      aria-hidden="true"
                    ></i
                  ></span>
                  <!-- <div class="d-flex flex-column custome-input">
                <mat-form-field color="accent" appearance="fill">
                  <mat-label>Choose Date</mat-label>
                  <input matInput [matDatepicker]="picker3" />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker3"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker3 color="primary"></mat-datepicker>
                </mat-form-field>
              </div> -->
                </th>
                <th scope="col">
                  <div
                    class="d-flex flex-column align-items-center custome-input mb-2"
                  >
                    <input
                      #csvInput
                      hidden="true"
                      type="file"
                      onclick="this.value=null"
                      (change)="csvInputChange($event)"
                    />
                    <i
                      class="fa fa-download"
                      aria-hidden="true"
                      style="font-size: 1.3rem"
                      (click)="csvInput.click()"
                    ></i>
                  </div>
                </th>
                <!-- <th scope="col"></th> -->
                <th scope="col" style="width: 115px"></th>
                <!-- <th scope="col"></th>
            <th scope="col"></th> -->
                <!-- <th scope="col"></th> -->
                <!-- <th colspan="3" scope="col">
                  ANNULAIZED IMPACT
                  <mat-slide-toggle
                    [(ngModel)]="isCHG"
                    (change)="toggleChange($event)"
                    [ngModelOptions]="{ standalone: true }"
                    >%CHG</mat-slide-toggle
                  >
                </th> -->
                <!-- <th class="custom"  scope="col"></th> -->
              </tr>
            </thead>
            <thead class="header-table">
              <tr style="height: 85px">
                <th style="text-align: left" scope="col">Product Group</th>
                <th scope="col">Current LP</th>
                <th scope="col">Current RSP</th>
                <th scope="col">Current COGS</th>
                <th scope="col" class="table-cal">
                  <div>LPI %</div>
                </th>
                <th scope="col" class="table-cal">
                  <div>% RSP Increase</div>
                </th>
                <th scope="col" class="table-cal">
                  <div>% COGS Increase</div>
                </th>
                <!-- <th scope="col">Base Price Elasticity Used</th> -->
                <th scope="col" class="table-cal">
                  <div>Base Price Elasticity</div>
                </th>
                <th scope="col">Competition</th>
                <!-- <th scope="col">MAC</th>
                <th scope="col">RP</th>
                <th scope="col">TE</th> -->
              </tr>
            </thead>
            <tbody>
              <!-- <div *ngIf="inputForm">
                <form [formGroup]="inputForm">
                  <div *ngFor="let control of inputForm.controls | keyvalue">
                     
                    <div formGroupName="{{ control.key }}">
                      <input matInput formControlName="product_group_retailer" />
                    </div>
                  </div>
                </form>
              </div> -->

              <ng-container *ngFor="let input of inputForm.controls | keyvalue">
                <tr style="height: 80px" formGroupName="{{ input.key }}">
                  <td scope="row" style="text-align: left">
                    <strong>{{
                      input.value.controls.product_group_retailer.value
                        | removeUnder
                    }}</strong>
                  </td>
                  <td style="font-size: 1rem;">
                    {{ input.value.controls.current_lpi.value }}
                    <strong> ₽</strong>
                  </td>
                  <td style="font-size: 1rem;">
                    {{ input.value.controls.current_rsp.value }}
                    <strong> ₽</strong>
                  </td>
                  <td style="font-size: 1rem;">
                    {{
                      input.value.controls.current_cogs.value
                        | number: decimalFormat
                    }}
                    <strong> ₽</strong>
                  </td>
                  <td style="padding: 0px">
                    <div
                      class="value-button"
                      id="decrease"
                      value="Decrease Value"
                      (click)="decreaseValue(input.key, 'lpi_increase')"
                    >
                      <i class="fa fa-minus" aria-hidden="true"></i>
                    </div>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="%"
                      value="0"
                      formControlName="lpi_increase"
                    />
                    <div
                      class="value-button"
                      id="increase"
                      (click)="increaseValue(input.key, 'lpi_increase')"
                      value="Increase Value"
                    >
                      <i class="fa fa-plus" aria-hidden="true"></i>
                    </div>
                  </td>
                  <td style="padding: 0px">
                    <div
                      class="value-button"
                      id="decrease"
                      value="Decrease Value"
                      (click)="decreaseValue(input.key, 'rsp_increase')"
                    >
                      <i class="fa fa-minus" aria-hidden="true"></i>
                    </div>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="%"
                      value="0"
                      formControlName="rsp_increase"
                    />
                    <div
                      class="value-button"
                      id="increase"
                      (click)="increaseValue(input.key, 'rsp_increase')"
                      value="Increase Value"
                    >
                      <i class="fa fa-plus" aria-hidden="true"></i>
                    </div>
                  </td>
                  <td style="padding: 0px">
                    <div
                      class="value-button"
                      id="decrease"
                      value="Decrease Value"
                      (click)="decreaseValue(input.key, 'cogs_increase')"
                    >
                      <i class="fa fa-minus" aria-hidden="true"></i>
                    </div>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="%"
                      formControlName="cogs_increase"
                    />
                    <div
                      class="value-button"
                      id="increase"
                      (click)="increaseValue(input.key, 'cogs_increase')"
                      value="Increase Value"
                    >
                      <i class="fa fa-plus" aria-hidden="true"></i>
                    </div>
                  </td>

                  <!-- <td>
                    {{ input.value.controls.base_price_elasticity.value }}
                  </td> -->
                  <td style="padding: 0;">
                    <input
                      type="text"
                      class="form-control ip"
                      [ngClass]="{
                        'color-change': update,
                        '': !update
                      }"
                      placeholder="%"
                      value="0"
                      formControlName="base_price_elasticity"
                    />
                  </td>
                  <td style="padding: 0;">
                    <mat-form-field class="demo-full-width" appearance="fill">
                      <select matNativeControl formControlName="competition" 
                      (change)="competitionChange($event.target.value , input)">
                        <option value=""></option>
                        <option value="Follows">Follows</option>
                        <option value="Not Follows">Not Follows</option>
                      </select>
                    </mat-form-field>
                  </td>
                  <!-- <td
                    class="custom"
                    [ngClass]="{
                      'color-danger': input.value.controls.mac.value < 0,
                      'color-success': input.value.controls.mac.value > 0
                    }"
                  >
                    {{ input.value.controls.mac.value | number: decimalFormat }}
                    <span *ngIf="isCHG && input.value.controls.mac.value"
                      >%</span
                    >
                  </td>
                  <td
                    class="custom"
                    [ngClass]="{
                      'color-danger': input.value.controls.rp.value < 0,
                      'color-success': input.value.controls.rp.value > 0
                    }"
                  >
                    {{ input.value.controls.rp.value | number: decimalFormat }}
                    <span *ngIf="isCHG && input.value.controls.rp.value"
                      >%</span
                    >
                  </td>
                  <td
                    class="custom"
                    [ngClass]="{
                      'color-danger': input.value.controls.te.value > 0,
                      'color-success': input.value.controls.te.value < 0
                    }"
                  >
                    {{ input.value.controls.te.value | number: decimalFormat }}
                    <span *ngIf="isCHG && input.value.controls.rp.value"
                      >%</span
                    >
                  </td> -->
                </tr>
              </ng-container>
            </tbody>
          </table>
          <!-- fa-angle-double-left -->
          <div class="align-self-center">
            <i
              (click)="expandTable()"
              class="fa"
              [ngClass]="{
                'fa-angle-double-left': !expanded_flag,
                'fa-angle-double-right': expanded_flag
              }"
              aria-hidden="true"
            ></i>
          </div>
          <!-- [ngStyle]="{'expanded': flag ? colorA : colorB}" -->
          <div
            class="d-flex"
            [ngClass]="expanded_flag ? 'expanded' : 'not-expanded'"
          >
            <table class="table table-bordered table-striped table-hover">
              <thead>
                <tr style="height: 65px">
                  <th colspan="3" scope="col">
                    ANNULAIZED IMPACT
                    <mat-slide-toggle
                      [(ngModel)]="isCHG"
                      (change)="toggleChange($event)"
                      [ngModelOptions]="{ standalone: true }"
                      >%CHG</mat-slide-toggle
                    >
                  </th>
                </tr>
              </thead>
              <thead>
                <tr style="height: 85px">
                  <th scope="col">MAC</th>
                  <th scope="col">RP</th>
                  <th scope="col">TE</th>
                </tr>
              </thead>
              <tbody>
                <!-- <ng-container *ngFor="let input of inputForm.controls | keyvalue">
                  <tr style="height: 70px" formGroupName="{{ input.key }}">
                    <td scope="row">
                      <strong>{{
                        input.value.controls.product_group_retailer.value
                      }}</strong>
                    </td> -->
                <ng-container
                  *ngFor="let input of inputForm.controls | keyvalue"
                >
                  <tr style="height: 80px" formGroupName="{{ input.key }}">
                    <td
                      style="padding: 0"
                      [ngClass]="{
                        'color-danger':
                          input.value.controls.mac.value < 0  ,
                        'color-success':
                          input.value.controls.mac.value > 0 
                      }"
                    >
                    
                    <span *ngIf="!isCHG"> 
                      {{
                        input.value.controls.mac.value
                          | convertTonnes: isCHG
                         
                      }}
                    </span><span *ngIf="isCHG"> 
                      {{
                        input.value.controls.mac.value  | number: decimalFormat
                          
                         
                      }}
                    </span>
                      <strong *ngIf="!isCHG"> ₽</strong>
                      <span *ngIf="isCHG && input.value.controls.mac.value"
                        >%
                        <i
                          class="fa"
                          aria-hidden="true"
                          [ngClass]="{
                            'color-danger fa-arrow-down':
                              input.value.controls.mac.value < 0  ,
                            'color-success fa-arrow-up':
                              input.value.controls.mac.value > 0 
                          }"
                        ></i>
                      </span>
                    </td>
                    <td
                      style="padding: 0"
                      [ngClass]="{
                        'color-danger':
                          input.value.controls.rp.value < 0  ,
                        'color-success':
                          input.value.controls.rp.value > 0 
                      }"
                    >
                    <span *ngIf="!isCHG"> 
                      {{
                        input.value.controls.rp.value
                          | convertTonnes: isCHG
                         
                      }}
                    </span><span *ngIf="isCHG"> 
                      {{
                        input.value.controls.rp.value  | number: decimalFormat
                          
                         
                      }}
                    </span>
                      <strong *ngIf="!isCHG"> ₽</strong>
                      <span *ngIf="isCHG && input.value.controls.rp.value"
                        >%
                        <i
                          class="fa"
                          aria-hidden="true"
                          [ngClass]="{
                            'color-danger fa-arrow-down':
                              input.value.controls.rp.value < 0  ,
                            'color-success fa-arrow-up':
                              input.value.controls.rp.value > 0  
                          }"
                        ></i>
                      </span>
                    </td>
                    <td
                      style="padding: 0"
                      [ngClass]="{
                        'color-danger':
                          input.value.controls.te.value > 0  ,
                        'color-success':
                          input.value.controls.te.value < 0 
                      }"
                    >
                    <span *ngIf="!isCHG"> 
                      {{
                        input.value.controls.te.value
                          | convertTonnes: isCHG
                         
                      }}
                    </span><span *ngIf="isCHG"> 
                      {{
                        input.value.controls.te.value  | number: decimalFormat
                          
                         
                      }}
                    </span>
                      <strong *ngIf="!isCHG"> ₽</strong>

                      <span *ngIf="isCHG && input.value.controls.te.value"
                        >%
                        <i
                          class="fa"
                          aria-hidden="true"
                          [ngClass]="{
                            'color-danger fa-arrow-up':
                              input.value.controls.te.value > 0  ,
                            'color-success fa-arrow-down':
                              input.value.controls.te.value < 0  
                          }"
                        ></i>
                      </span>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
          <!-- <table>

          </table> -->
        </div>
      </form>
    </ng-container>

    <!-- <div class="col-2">
      <table class="table table-dark">
        <thead>
          <tr>
            <th scope="col"></th>
            <th scope="col">DATE</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <thead>
          <tr>
            <th scope="col">MAC</th>
            <th scope="col">RP</th>
            <th scope="col">TE</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Mark</td>
            <td>Otto</td>
            <td>@mdo</td>
          </tr>
        </tbody>
      </table>
    </div> -->
  </div>
  <!-- <div class="row p-3 cust" #scrollHeader [class.sticky_]="sticky"> -->
  <!-- <div class="col"> -->
  <div class="row cust" #scrollHeader>
    <div class="d-flex flex-row flex-fill p-2 justify-content-end">
      <div class="flex-grow-1">
        <a (click)="simulateFn()" class="btn btn-primary mx-2 eq"
          >Simulate Scenario
        </a>
      </div>
      <a (click)="resetFormGroup()" class="btn btn-primary mx-2 eq"
        >Reset Scenario</a
      >
      <a (click)="open(mymodal)" class="btn btn-primary mx-2 eq"
        >Load Scenario</a
      >

      <a (click)="open(mymodal)" class="btn btn-primary mx-2 eq"
        >Save Scenario</a
      >
      <a routerLink="/compare" class="btn btn-primary mx-2 eq"
        >Compare Scenario</a
      >
    </div>
    <!-- <div class="d-flex flex-row flex-fill p-2 justify-content-between">
        <a (click)="goToDashboard()" class="btn btn-primary">Dashboard</a>
        <a (click)="simulateSummary(simulate)" class="btn btn-primary"
          >Summary</a
        >

        <a (click)="open(mymodal)" class="btn btn-primary">Save Scenario</a>
        <a routerLink="/compare" class="btn btn-primary">Compare Scenario</a>
        <a
          *ngIf="isSimulate"
          (click)="downloadSummary()"
          class="btn btn-primary"
          ><i class="fa fa-download pr-1" aria-hidden="true"></i
        ></a>
      </div> -->
  </div>
  <!-- </div> -->
</div>

<!-- Modal -->
<ng-template #mymodal let-modal>
  <div class="modal-header">
    <h4 class="modal-title text-dark" id="modal-basic-title">Save Scenario</h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      #closebutton
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">×</span>
    </button>
  </div>
  <div class="modal-body">
    <!-- <div class="form-group"> -->
    <!-- <mat-form-field class="example-full-width">
        <mat-label>Name</mat-label>
        <input
          matInput
          [(ngModel)]="scenarioName"
          [ngModelOptions]="{ standalone: true }"
        />
      </mat-form-field> -->
    <!-- </div> -->
    <div class="form-group">
      <label for="usr">Name:</label>
      <input
        type="text"
        class="form-control"
        id="usr"
        [(ngModel)]="scenarioName"
      />
    </div>
    <div class="form-group">
      <label for="pwd">Comments:</label>
      <textarea
        class="form-control"
        rows="5"
        [(ngModel)]="scenarioComment"
        id="comment"
      ></textarea>
    </div>
    <!-- <div class="form-group">
      <mat-form-field class="example-full-width">
        <mat-label>Comments</mat-label>
        <input
          matInput
          [(ngModel)]="scenarioComment"
          [ngModelOptions]="{ standalone: true }"
        />
      </mat-form-field>
    </div> -->
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-primary"
      (click)="saveScenario(mymodal)"
    >
      Save
    </button>
    <!--  (click)="modal.close('Save click')" -->
  </div>
</ng-template>
