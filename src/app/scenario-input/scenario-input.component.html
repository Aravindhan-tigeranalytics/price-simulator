<div class="container-fluid">
  <div class="row py-1 my-3 cust">
    <div class="col-8">
      <div
        #initElement
        class="d-flex flex-row justify-content-between align-items-center"
      >
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Select Retailer</mat-label>
            <mat-select [formControl]="retailers" multiple>
              <mat-option [value]="'ALL'">All</mat-option>
              <mat-option
                *ngFor="let retailer of retailer_filter"
                [value]="retailer"
                >{{ retailer }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Select Category</mat-label>
            <mat-select [formControl]="categories" multiple>
              <mat-option [value]="'ALL'">All</mat-option>
              <mat-option
                *ngFor="let category of categories_filter"
                [value]="category"
                >{{ category }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Select PPG</mat-label>
            <mat-select [formControl]="products" multiple>
              <mat-option [value]="'ALL'">All</mat-option>
              <mat-option
                *ngFor="let product of product_filter"
                [value]="product"
                >{{ product }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="d-flex flex-row justify-content-start align-items-center">
        <div class="p-2 flex-fill">
          <a class="btn btn-primary btn-block" (click)="applyFilter()">Apply</a>
        </div>
        <div class="p-2 flex-fill">
          <a class="btn btn-primary btn-block" (click)="resetFilter()">Reset</a>
        </div>
      </div>
    </div>
  </div>
  <div class="row mb-2">
    <ng-container *ngIf="inputForm">
      <form [formGroup]="inputForm">
        <div class="col table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th scope="col"></th>
                <th scope="col"></th>
                <th scope="col"></th>
                <th scope="col"></th>

                <th scope="col">
                  <!-- <mat-chip
                >11/24/20
              
              </mat-chip> -->
                  <!-- <div class="d-flex flex-column custome-input">
                
                <mat-form-field color="accent" appearance="fill">
                  <mat-label>Choose Date</mat-label>
                  <input
                    matInput
                    [(ngModel)]="date"
                    [matDatepicker]="picker1"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker1"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker1 color="primary"></mat-datepicker>
                </mat-form-field>
              </div> -->
                </th>
                <th scope="col">
                  <!-- <div class="d-flex flex-column custome-input">
                <mat-form-field color="accent" appearance="fill">
                  <mat-label>Choose Date</mat-label>
                  <input matInput [matDatepicker]="picker2" />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker2"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker2 color="primary"></mat-datepicker>
                </mat-form-field>
              </div> -->
                </th>
                <th scope="col">
                  <!-- <div class="d-flex flex-column custome-input">
                <mat-form-field color="accent" appearance="fill">
                  <mat-label>Choose Date</mat-label>
                  <input matInput [matDatepicker]="picker3" />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker3"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker3 color="primary"></mat-datepicker>
                </mat-form-field>
              </div> -->
                </th>
                <th scope="col"></th>
                <th scope="col"></th>
                <th scope="col"></th>
                <!-- <th scope="col"></th>
            <th scope="col"></th> -->
                <!-- <th scope="col"></th> -->
                <th colspan="3" scope="col">
                  ANNULAIZED IMPACT
                  <mat-slide-toggle>%CHG</mat-slide-toggle>
                </th>
                <!-- <th class="custom"  scope="col"></th> -->
              </tr>
            </thead>
            <thead class="header-table">
              <tr>
                <th scope="col">Product Group</th>
                <th scope="col">Current LP</th>
                <th scope="col">Current RSP</th>
                <th scope="col">Current COGS</th>
                <th scope="col">
                  <div class="d-flex flex-column custome-input">
                    <mde-popover
                      #appPopover="mdePopover"
                      [mdePopoverOverlapTrigger]="false"
                    >
                      <mat-card style="max-width: 300px">
                        <mat-card-content>
                          <span *ngIf="date; else selectDate1"
                            >{{ date | date }}
                            <i
                              class="fa fa-trash"
                              (click)="resetDate()"
                              aria-hidden="true"
                            ></i
                          ></span>
                          <ng-template #selectDate1>
                            Please click here to select a date
                          </ng-template>
                        </mat-card-content>
                      </mat-card>
                    </mde-popover>

                    <mat-form-field color="accent" appearance="fill">
                      <mat-label>Choose Date</mat-label>
                      <input
                        matInput
                        [(ngModel)]="date"
                        [ngModelOptions]="{ standalone: true }"
                        [matDatepicker]="picker1"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker1"
                        [mdePopoverTriggerFor]="appPopover"
                        mdePopoverTriggerOn="hover"
                        #popoverTrigger="mdePopoverTrigger"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker1 color="primary"></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <div>LPI %</div>
                </th>
                <th scope="col">
                  <div class="d-flex flex-column custome-input">
                    <mat-form-field color="accent" appearance="fill">
                      <mat-label>Choose Date</mat-label>
                      <input matInput [matDatepicker]="picker2" />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker2"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker2 color="primary"></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <div>% RSP Increase</div>
                </th>
                <th scope="col">
                  <div class="d-flex flex-column custome-input">
                    <mat-form-field color="accent" appearance="fill">
                      <mat-label>Choose Date</mat-label>
                      <input matInput [matDatepicker]="picker3" />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker3"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker3 color="primary"></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <div>% COGS Increase</div>
                </th>
                <th scope="col">Base Price Elasticity Used</th>
                <th scope="col">Base Price Elasticity(Manual Override)</th>
                <th scope="col">Competition</th>
                <th scope="col">MAC</th>
                <th scope="col">RP</th>
                <th scope="col">TE</th>
              </tr>
            </thead>
            <tbody>
              <!-- <div *ngIf="inputForm">
                <form [formGroup]="inputForm">
                  <div *ngFor="let control of inputForm.controls | keyvalue">
                     
                    <div formGroupName="{{ control.key }}">
                      <input matInput formControlName="product_group_retailer" />
                    </div>
                  </div>
                </form>
              </div> -->

              <ng-container *ngFor="let input of inputForm.controls | keyvalue">
                <tr formGroupName="{{ input.key }}">
                  <th scope="row">
                    {{ input.value.controls.product_group_retailer.value }}
                  </th>
                  <td>
                    <strong
                      >₽
                      {{ input.value.controls.current_lpi.value }}
                    </strong>
                  </td>
                  <td>
                    <strong
                      >₽{{ input.value.controls.current_rsp.value }}</strong
                    >
                  </td>
                  <td>
                    <strong
                      >₽{{ input.value.controls.current_cogs.value }}</strong
                    >
                  </td>
                  <td>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="%"
                      value="0"
                      formControlName="lpi_increase"
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="%"
                      value="0"
                      formControlName="rsp_increase"
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="%"
                      formControlName="cogs_increase"
                    />
                  </td>
                  <td>
                    {{ input.value.controls.base_price_elasticity.value }}
                  </td>
                  <td>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="%"
                      value="0"
                      formControlName="base_price_elasticity_manual"
                    />
                  </td>
                  <td>
                    <mat-form-field class="demo-full-width" appearance="fill">
                      <select matNativeControl>
                        <option value=""></option>
                        <option value="Follows" selected>Follows</option>
                        <option value="Not Follows">Not Follows</option>
                      </select>
                    </mat-form-field>
                  </td>
                  <td class="custom">{{ input.value.controls.mac.value }}</td>
                  <td class="custom">{{ input.value.controls.rp.value }}</td>
                  <td class="custom">{{ input.value.controls.te.value }}</td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
      </form>
    </ng-container>

    <!-- <div class="col-2">
      <table class="table table-dark">
        <thead>
          <tr>
            <th scope="col"></th>
            <th scope="col">DATE</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <thead>
          <tr>
            <th scope="col">MAC</th>
            <th scope="col">RP</th>
            <th scope="col">TE</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Mark</td>
            <td>Otto</td>
            <td>@mdo</td>
          </tr>
        </tbody>
      </table>
    </div> -->
  </div>
  <div class="row p-3 cust" #scrollHeader [class.sticky]="sticky">
    <!-- <div class="col"> -->
    <div
      class="container d-flex flex-row justify-content-between align-items-center"
    >
      <a routerLink="/dashboard" class="btn btn-primary custom-button"
        >Dashboard</a
      >
      <a (click)="simulateSummary(simulate)" class="btn btn-primary"
        >Simulate summary</a
      >

      <a (click)="open(mymodal)" class="btn btn-primary">Save Scenario</a>
      <a routerLink="/compare" class="btn btn-primary">Compare Scenario</a>
      <a *ngIf="isSimulate" class="btn btn-primary"
        ><i class="fa fa-download pr-1" aria-hidden="true"></i
      ></a>
      <!-- <a href="#" class="btn"
      ></i
    ></a> -->
      <!-- </div> -->
    </div>
  </div>
  <section class="simulate" #simulate>
    <!-- <table *ngIf="isSimulate" class="table">
      <thead>
        <tr style="font-size: 12px">
          <th scope="col"></th>
          <th scope="col">Units</th>
          <th scope="col">Tonnes</th>
          <th scope="col">LSV</th>
          <th scope="col">RSV</th>
          <th scope="col">NSV</th>
          <th scope="col">NSV/Tonnes</th>
          <th scope="col">TE</th>
          <th scope="col">TE,%LSV</th>
          <th scope="col">TE,Units</th>
          <th scope="col">MAC</th>
          <th class="custom" scope="col">MAC,%NSV</th>
          <th class="custom" scope="col">RP</th>
          <th class="custom" scope="col">RP,%RSV</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let input of params">
          <th scope="row">{{ input }}</th>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td class="custom">0</td>
          <td class="custom">0</td>
          <td class="custom">0</td>
        </tr>
      </tbody>
    </table> -->
    <!-- ACCORDION -->
    <mat-accordion *ngIf="isSimulate">
      <mat-expansion-panel
        (opened)="panelOpenState = true"
        (closed)="panelOpenState = false"
        [expanded]="true"
      >
        <mat-expansion-panel-header>
          <!-- <mat-panel-title> All </mat-panel-title> -->
          <mat-panel-description> All </mat-panel-description>
        </mat-expansion-panel-header>
        <table *ngIf="isSimulate" class="table">
          <thead>
            <tr style="font-size: 12px">
              <th scope="col"></th>
              <th scope="col">Units</th>
              <th scope="col">Tonnes</th>
              <th scope="col">LSV</th>
              <th scope="col">RSV</th>
              <th scope="col">NSV</th>
              <th scope="col">NSV/Tonnes</th>
              <th scope="col">TE</th>
              <th scope="col">TE,%LSV</th>
              <th scope="col">TE,Units</th>
              <th scope="col">MAC</th>
              <th scope="col">MAC,%NSV</th>
              <th scope="col">RP</th>
              <th scope="col">RP,%RSV</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let input of params">
              <th scope="row">{{ input }}</th>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td class="custom">0</td>
              <td class="custom">0</td>
              <td class="custom">0</td>
            </tr>
          </tbody>
        </table>
      </mat-expansion-panel>
      <mat-expansion-panel *ngFor="let input of inputList">
        <mat-expansion-panel-header>
          <!-- <mat-panel-title> {{ input }} </mat-panel-title> -->
          <mat-panel-description> {{ input }} </mat-panel-description>
        </mat-expansion-panel-header>
        <table *ngIf="isSimulate" class="table">
          <thead>
            <tr style="font-size: 12px">
              <th scope="col"></th>
              <th scope="col">Units</th>
              <th scope="col">Tonnes</th>
              <th scope="col">LSV</th>
              <th scope="col">RSV</th>
              <th scope="col">NSV</th>
              <th scope="col">NSV/Tonnes</th>
              <th scope="col">TE</th>
              <th scope="col">TE,%LSV</th>
              <th scope="col">TE,Units</th>
              <th scope="col">MAC</th>
              <th scope="col">MAC,%NSV</th>
              <th scope="col">RP</th>
              <th scope="col">RP,%RSV</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let input of params">
              <th scope="row">{{ input }}</th>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td class="custom">0</td>
              <td class="custom">0</td>
              <td class="custom">0</td>
            </tr>
          </tbody>
        </table>
      </mat-expansion-panel>
    </mat-accordion>
    <!-- ACCORDION ENDS -->
  </section>
</div>

<!-- Modal -->
<ng-template #mymodal let-modal>
  <div class="modal-header">
    <h4 class="modal-title text-dark" id="modal-basic-title">Save Scenario</h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">×</span>
    </button>
  </div>
  <div class="modal-body m-auto">
    <div class="form-group">
      <mat-form-field class="example-full-width">
        <mat-label>Name</mat-label>
        <input matInput />
      </mat-form-field>
    </div>
    <div class="form-group">
      <mat-form-field class="example-full-width">
        <mat-label>Comments</mat-label>
        <input matInput />
      </mat-form-field>
    </div>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-dark"
      (click)="modal.close('Save click')"
    >
      Save
    </button>
  </div>
</ng-template>
